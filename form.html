<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id=' + i + dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MS5DPN2S');</script>
  <!-- End Google Tag Manager -->

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https:; img-src 'self' data: https:; style-src 'self' 'unsafe-inline' https:; connect-src 'self' https:; frame-src 'self' https:;">
  <title>Apply for Online Coaching | REACH by Antoine</title>
  <meta name="description" content="Complete the short form to apply for REACH online coaching with coach Antoine.">
  <link rel="preload" href="style.css" as="style" onload="this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="style.css"></noscript>

  <!-- Promo Configuration -->
  <script src="promo-config.js"></script>

  <!-- ContentSquare -->
  <script src="https://t.contentsquare.net/uxa/6f17786e21554.js"></script>
</head>
<body class="form-body">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MS5DPN2S"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <header class="form-header">
    <div class="form-header-inner">
      <a href="index.html" class="form-logo" aria-label="Return to homepage">
        <img src="01-IMAGES/logo_reach.webp" alt="REACH by Antoine" width="160" height="60" loading="lazy">
      </a>
      <p class="form-header-text">Step 1 · Tell me about you</p>
    </div>
  </header>

  <main class="form-main">
    <section class="form-intro">
      <div class="form-free-badge">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 11l3 3L22 4"></path>
          <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
        </svg>
        <span>No payment required</span>
      </div>
      <h1>Start Your Online Coaching Application</h1>
      <h2 class="form-subtitle">Tell me more about you.</h2>
      <p class="form-description">Complete this quick form so I can understand your situation and goals. Then we'll chat on WhatsApp to see how I can best help you.</p>
    </section>

    <section class="form-next-steps">
      <h3>What Happens Next?</h3>
      <p class="next-steps-description">I'll review your application within 24 hours and reach out on WhatsApp to discuss your goals and answer any questions.</p>
      <div class="next-steps-grid">
        <div class="next-step-card">
          <div class="next-step-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
          </div>
          <h4>No payment yet</h4>
        </div>
        <div class="next-step-card">
          <div class="next-step-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
          </div>
          <h4>No commitment</h4>
        </div>
        <div class="next-step-card">
          <div class="next-step-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
          </div>
          <h4>Reply within 24 hours</h4>
        </div>
      </div>
    </section>

    <form class="coaching-form" id="coachingForm" novalidate>
      <div class="form-grid">
        <label class="form-field">
          <span>Full name *</span>
          <input type="text" name="fullName" id="fullName" autocomplete="name" required>
        </label>

        <label class="form-field">
          <span>Email *</span>
          <input type="email" name="email" id="email" inputmode="email" autocomplete="email" required>
        </label>

        <label class="form-field">
          <span>WhatsApp number *</span>
          <input type="tel" name="whatsapp" id="whatsapp" inputmode="tel" autocomplete="tel" placeholder="+44 0000 000000" required>
        </label>

        <label class="form-field">
          <span>Where are you based?</span>
          <input type="text" name="location" id="location" placeholder="City, Country">
        </label>

        <label class="form-field form-field-wide">
          <span>What are your goals right now?</span>
          <textarea name="goals" id="goals" rows="4" placeholder="Tell me about your current situation, objectives, and any challenges."></textarea>
        </label>
      </div>

      <div class="form-actions">
        <button type="submit" class="form-submit-button">Send my application</button>
        <p class="form-disclaimer">No payment is required at this stage. I will contact you personally to finalize everything.</p>
      </div>
      <p class="form-status-message" id="formStatus" aria-live="polite"></p>
    </form>

  </main>

  <footer class="form-footer">
    <p>© <span id="formYear"></span> REACH by Antoine. All rights reserved.</p>
  </footer>

  <script>
    (function () {
      const SECURITY_CONFIG = {
        localStorageKey: 'reachFormSubmissions',
        webhookURL: 'https://hooks.airtable.com/workflows/v1/genericWebhook/appDKRjPsZbEVt0iJ/wflE1Sy1QoDzTUpHL/wtr7nw1o8KVBsecw8',
        retryIntervalMinutes: 5,
        email: {
          enabled: false,
          publicKey: '',
          serviceId: '',
          templateId: '',
          toEmail: ''
        }
      };

      const CONTACT_FALLBACK_MESSAGE = 'We saved your application locally and will retry automatically once the connection is restored.';

      const CONTACT_EMAIL_FALLBACK = SECURITY_CONFIG.email.toEmail && !SECURITY_CONFIG.email.toEmail.includes('REPLACE')
        ? SECURITY_CONFIG.email.toEmail
        : 'your-email@example.com';

      const params = new URLSearchParams(window.location.search);
      const form = document.getElementById('coachingForm');
      const formFields = form.querySelectorAll('input[required], select[required]');
      const submitButton = form.querySelector('.form-submit-button');
      const formStatus = document.getElementById('formStatus');
      const footerYear = document.getElementById('formYear');
      footerYear.textContent = new Date().getFullYear();

      function checkLocalStorageAvailable() {
        try {
          const testKey = '__reach_form_test__';
          localStorage.setItem(testKey, '1');
          localStorage.removeItem(testKey);
          return true;
        } catch (error) {
          console.warn('[Reach Form] LocalStorage unavailable:', error);
          return false;
        }
      }

      const localStorageAvailable = checkLocalStorageAvailable();
      const queueEnabled = localStorageAvailable && Boolean(SECURITY_CONFIG.localStorageKey);
      let queueCache = queueEnabled ? loadQueueFromStorage() : [];
      let emailJsInitialized = false;

      if (queueEnabled) {
        window.addEventListener('storage', event => {
          if (event.key === SECURITY_CONFIG.localStorageKey) {
            queueCache = loadQueueFromStorage();
          }
        });
      }

      function loadQueueFromStorage() {
        try {
          const raw = localStorage.getItem(SECURITY_CONFIG.localStorageKey);
          if (!raw) return [];
          const parsed = JSON.parse(raw);
          return Array.isArray(parsed) ? parsed : [];
        } catch (error) {
          console.error('[Reach Form] Failed to load queue from storage:', error);
          return [];
        }
      }

      function persistQueue() {
        if (!queueEnabled) return;
        try {
          localStorage.setItem(SECURITY_CONFIG.localStorageKey, JSON.stringify(queueCache));
        } catch (error) {
          console.error('[Reach Form] Unable to persist queue:', error);
        }
      }

      function addRecord(record) {
        if (!queueEnabled) return record;
        queueCache.push(record);
        persistQueue();
        return record;
      }

      function getRecord(recordId) {
        if (!queueEnabled) return null;
        return queueCache.find(item => item.id === recordId) || null;
      }

      function updateRecord(recordId, updates) {
        if (!queueEnabled) return null;
        const index = queueCache.findIndex(item => item.id === recordId);
        if (index === -1) return null;
        queueCache[index] = { ...queueCache[index], ...updates };
        persistQueue();
        return queueCache[index];
      }

      function createRecord(payload) {
        return {
          id: `sub_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`,
          status: 'queued',
          payload,
          createdAt: new Date().toISOString(),
          lastAttemptAt: null,
          submittedAt: null,
          backupEmailAt: null,
          lastError: null,
          lastEmailError: null
        };
      }

      function shouldRetry(record) {
        if (!record || !record.lastAttemptAt) return true;
        const lastAttempt = Date.parse(record.lastAttemptAt);
        if (Number.isNaN(lastAttempt)) return true;
        const diffMs = Date.now() - lastAttempt;
        return diffMs >= (SECURITY_CONFIG.retryIntervalMinutes * 60 * 1000);
      }

      function initEmailJS() {
        if (!SECURITY_CONFIG.email.enabled) return false;
        if (emailJsInitialized) return true;
        const { publicKey, serviceId, templateId, toEmail } = SECURITY_CONFIG.email;
        if (!window.emailjs) {
          console.warn('[Reach Form] EmailJS library not loaded yet.');
          return false;
        }
        if (
          !publicKey || !serviceId || !templateId || !toEmail ||
          publicKey.includes('REPLACE') || serviceId.includes('REPLACE') ||
          templateId.includes('REPLACE') || toEmail.includes('REPLACE')
        ) {
          console.warn('[Reach Form] EmailJS configuration is incomplete.');
          return false;
        }
        window.emailjs.init(publicKey);
        emailJsInitialized = true;
        return true;
      }

      async function sendEmailBackup(record, errorMessage) {
        if (!SECURITY_CONFIG.email.enabled) {
          return { success: false, reason: 'disabled' };
        }
        if (!initEmailJS()) {
          return { success: false, reason: 'not_configured' };
        }

        const latestRecord = record && record.id ? (getRecord(record.id) || record) : record;
        const payload = latestRecord?.payload || {};
        const templateParams = {
          to_email: SECURITY_CONFIG.email.toEmail,
          submission_id: latestRecord?.id || `temp_${Date.now()}`,
          error_message: errorMessage || '',
          submitted_at: latestRecord?.createdAt || new Date().toISOString(),
          payload_json: JSON.stringify(payload, null, 2),
          full_name: payload.fullName || '',
          email: payload.email || '',
          whatsapp: payload.whatsapp || '',
          location: payload.location || '',
          goals: payload.goals || ''
        };

        try {
          await window.emailjs.send(
            SECURITY_CONFIG.email.serviceId,
            SECURITY_CONFIG.email.templateId,
            templateParams
          );
          if (queueEnabled && latestRecord?.id) {
            updateRecord(latestRecord.id, {
              status: 'backup_sent',
              backupEmailAt: new Date().toISOString(),
              lastEmailError: null,
              lastError: errorMessage || null
            });
          }
          return { success: true };
        } catch (emailError) {
          if (queueEnabled && latestRecord?.id) {
            updateRecord(latestRecord.id, {
              status: 'backup_failed',
              backupEmailAt: new Date().toISOString(),
              lastEmailError: emailError.message || 'Email backup failed',
              lastError: errorMessage || null
            });
          }
          console.error('[Reach Form] Backup email failed:', emailError);
          return { success: false, error: emailError };
        }
      }

      async function sendToAirtable(payload) {
        const submissionBody = new URLSearchParams();
        Object.entries(payload).forEach(([key, value]) => {
          submissionBody.append(key, value ?? '');
        });
        await fetch(SECURITY_CONFIG.webhookURL, {
          method: 'POST',
          mode: 'no-cors',
          body: submissionBody
        });
      }

      async function attemptSubmissionRecord(record, options = {}) {
        const allowBackup = options.allowBackup !== false;
        if (!queueEnabled || !record) {
          await sendToAirtable(record?.payload || {});
          return { success: true, record };
        }

        const attemptIso = new Date().toISOString();
        updateRecord(record.id, { status: 'sending', lastAttemptAt: attemptIso });

        try {
          await sendToAirtable(record.payload);
          const updated = updateRecord(record.id, {
            status: 'submitted',
            submittedAt: new Date().toISOString(),
            lastError: null
          });
          return { success: true, record: updated };
        } catch (submissionError) {
          const errorMessage = submissionError?.message || 'Network error';
          const updated = updateRecord(record.id, {
            status: 'queued',
            lastError: errorMessage,
            lastAttemptAt: attemptIso
          });

          if (!allowBackup) {
            return { success: false, record: updated, error: errorMessage };
          }

          const backup = await sendEmailBackup(updated, errorMessage);
          return { success: false, record: getRecord(record.id) || updated, error: errorMessage, backup };
        }
      }

      async function attemptDirectSubmission(payload) {
        try {
          await sendToAirtable(payload);
          return { success: true };
        } catch (error) {
          const errorMessage = error?.message || 'Network error';
          const tempRecord = { id: `temp_${Date.now()}`, payload };
          const backup = await sendEmailBackup(tempRecord, errorMessage);
          return { success: false, error: errorMessage, backup };
        }
      }

      async function processPendingQueue() {
        if (!queueEnabled || !queueCache.length) return;
        for (const record of [...queueCache]) {
          if (!record || (record.status !== 'queued' && record.status !== 'backup_failed')) continue;
          if (!shouldRetry(record)) continue;
          try {
            await attemptSubmissionRecord(record, { allowBackup: false });
          } catch (error) {
            // Automatic retries will try again later.
          }
        }
      }

      if (queueEnabled) {
        setTimeout(processPendingQueue, 3000);
        window.addEventListener('online', () => processPendingQueue());
        setInterval(processPendingQueue, SECURITY_CONFIG.retryIntervalMinutes * 60 * 1000);
      }

      form.addEventListener('submit', async function (event) {
        event.preventDefault();
        let isValid = true;

        formFields.forEach(field => {
          if (!field.checkValidity()) {
            field.classList.add('form-error');
            isValid = false;
          } else {
            field.classList.remove('form-error');
          }
        });

        if (!isValid) {
          form.reportValidity();
          return;
        }

        const fullName = document.getElementById('fullName').value.trim();
        const email = document.getElementById('email').value.trim();
        const whatsapp = document.getElementById('whatsapp').value.trim();
        const location = document.getElementById('location').value.trim();
        const goals = document.getElementById('goals').value.trim();

        const payload = {
          fullName,
          email,
          whatsapp,
          location,
          goals,
          submittedAt: new Date().toISOString(),
          sourcePage: window.location.href
        };

        submitButton.disabled = true;
        submitButton.textContent = 'Sending...';
        formStatus.textContent = 'Sending your application...';
        formStatus.classList.remove('is-error', 'is-success');

        let record = null;
        if (queueEnabled) {
          record = addRecord(createRecord(payload));
        }

        let outcome;
        if (record) {
          outcome = await attemptSubmissionRecord(record, { allowBackup: true });
        } else {
          outcome = await attemptDirectSubmission(payload);
        }

        if (outcome.success) {
          form.reset();
          formStatus.textContent = 'Application sent! I will reach out within 24 hours.';
          window.dataLayer = window.dataLayer || [];
          window.dataLayer.push({
           event: 'application_submitted',
         });

          formStatus.classList.remove('is-error');
          formStatus.classList.add('is-success');
          submitButton.disabled = false;
          submitButton.textContent = 'Send my application';
          processPendingQueue();
          return;
        }

        formStatus.textContent = CONTACT_FALLBACK_MESSAGE;
        formStatus.classList.remove('is-success');
        formStatus.classList.add('is-error');
        submitButton.disabled = false;
        submitButton.textContent = 'Send my application';
      });
    })();
  </script>
</body>
</html>

